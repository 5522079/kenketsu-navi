<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>献血ナビ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="../static/css/subsub.css">
    <script type="text/javascript">
        $(function(){
            var countElm = $('.count'),
                duration = 2000; // 2秒でカウントアップを完了させる

            countElm.each(function(){
                var self = $(this),
                    countMax = parseFloat(self.attr('data-count')), // data-numから最大値を取得
                    thisCount = 0, // 初期値
                    frameRate = 60, // 1秒間に60フレーム（約16msごとに更新）
                    totalFrames = (duration / 1000) * frameRate, // 2秒間に何回更新するか
                    increment = countMax / totalFrames, // 1フレームごとの増加量
                    countTimer;

                function timer() {
                    countTimer = setInterval(function(){
                        thisCount += increment; // 増加量を追加
                        self.text(Math.floor(thisCount)); // 表示は整数にする

                        if (thisCount >= countMax) { // カウントが最大値を超えたら終了
                            self.text(countMax); // 最終値を正確に表示
                            clearInterval(countTimer);
                        }
                    }, 1000 / frameRate); // 毎秒60回更新
                }
                timer();
            });
        });
    </script>
</head>
<body>
    <header>
        <a href="/"><img src="../static/images/logo.png" alt="Image description" /></a>
        <div class="header-items">
                <ul>
                    <li><a class="header-item" href="/about">このサイトについて</a></li>
                    <li><a class="header-item" href="/about#contact">お問い合わせ</a></li>
                </ul>
                <div class="hamburger-menu">
                    <input type="checkbox" id="overlay-input" />
                    <label for="overlay-input" id="overlay-button">
                    <span></span>
                    </label>
                    <div id="overlay">
                        <ul>
                            <li><a href="/">トップページ</a></li>
                            <li><a href="/about">このサイトについて</a></li>
                            <li><a href="/about#contact">お問い合わせ</a></li>
                        </ul>
                    </div>
                </div>
        </div>
    </header>
    <ol class="breadcrumb">
        <li><a href="/">TOP</a></li>
        <li><a href="/nationwide">全国</a></li>
        <li>{{prefecture_name}}</li>
    </ol>
    <div class="main-content">
        <h1>献血者数予測AI</h1>
        <p class="content-detail">({{prefecture_name}} | {{update}}更新)</p>
        <section class="predict">
            <div class="box">
                <p class="box-detail"><strong>グラフをご覧いただく際の注意点：</strong>ご利用のデバイスによっては、グラフの表示に異なるスケールや比率が適用される場合があり、見た目に違いが生じることがあります。</p>
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                        <script>
                            var ctx = document.getElementById('lineChart').getContext('2d');
                            var months = {{ months | tojson }};
                            var data1 = {{ data1 | tojson }};
                            var data2 = {{ data2 | tojson }};
                            var data3 = data1.slice(-3);
                            var lastThreeMonths = months.slice(-3);
                            var myChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: months,
                                    datasets: [
                                        {
                                            label: '予測献血者数',
                                            type: 'line',
                                            data: [...Array(months.length - 3).fill(null), ...data3],
                                            borderColor: '#073365',
                                            borderWidth: 4,
                                        },
                                        {
                                            label: '今年の献血者数',
                                            type: 'line',
                                            data: data1,
                                            borderColor: '#f7581d',
                                        },
                                        {
                                            label: '昨年の献血数',
                                            type: 'bar',
                                            data: data2,
                                            backgroundColor: '#ede8e4',
                                            borderColor: '#ede8e4',
                                            borderWidth: 1
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true
                                        }
                                    }
                                }
                            });
                        </script>
                    </div>
            </div>
        </section>
        <h1>現在の献血状況</h1>
        <p class="content-detail">({{prefecture_name}} | {{update}}更新)</p>
        <section class="status">
            <div class="box">
                <h2>400mL</h2>
                <div class="inner-box-container">
                    <div class="inner-box" style="background-color: {{a4_col[0]}};">
                        <p class="status-type" style="color: {{a4_col[1]}};">A型</p>
                        <p style="color: {{a4_col[1]}};">{{a4}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{o4_col[0]}};">
                        <p class="status-type" style="color: {{o4_col[1]}};">O型</p>
                        <p style="color: {{o4_col[1]}};">{{o4}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{b4_col[0]}};">
                        <p class="status-type" style="color: {{b4_col[1]}};">B型</p>
                        <p style="color: {{b4_col[1]}};">{{b4}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{ab4_col[0]}};">
                        <p class="status-type" style="color: {{ab4_col[1]}};">AB型</p>
                        <p style="color: {{ab4_col[1]}};">{{ab4}}</p>
                    </div>
                </div>
            </div>
            <div class="box">
                <h2>200mL</h2>
                <div class="inner-box-container">
                    <div class="inner-box" style="background-color: {{a2_col[0]}};">
                        <p class="status-type" style="color: {{a2_col[1]}};">A型</p>
                        <p style="color: {{a2_col[1]}};">{{a2}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{o2_col[0]}};">
                        <p class="status-type" style="color: {{o2_col[1]}};">O型</p>
                        <p style="color: {{o2_col[1]}};">{{o2}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{b2_col[0]}};">
                        <p class="status-type" style="color: {{b2_col[1]}};">B型</p>
                        <p style="color: {{b2_col[1]}};">{{b2}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{ab2_col[0]}};">
                        <p class="status-type" style="color: {{ab2_col[1]}};">AB型</p>
                        <p style="color: {{ab2_col[1]}};">{{ab2}}</p>
                    </div>
                </div>
            </div>
            <div class="box">
                <h2>成分献血</h2>
                <div class="inner-box-container">
                    <div class="inner-box" style="background-color: {{ac_col[0]}};">
                        <p class="status-type" style="color: {{ac_col[1]}};">A型</p>
                        <p style="color: {{ac_col[1]}};">{{ac}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{oc_col[0]}};">
                        <p class="status-type" style="color: {{oc_col[1]}};">O型</p>
                        <p style="color: {{oc_col[1]}};">{{oc}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{bc_col[0]}};">
                        <p class="status-type" style="color: {{bc_col[1]}};">B型</p>
                        <p style="color: {{bc_col[1]}};">{{bc}}</p>
                    </div>
                    <div class="inner-box" style="background-color: {{abc_col[0]}};">
                        <p class="status-type" style="color: {{abc_col[1]}};">AB型</p>
                        <p style="color: {{abc_col[1]}};">{{abc}}</p>
                    </div>
                </div>
            </div>
        </section>
        <h1>数字で見る献血事業</h1>
        <p class="content-detail">({{prefecture_name}} | {{update}}更新 | ※2017年1月から集計)</p>
        <section class="data">
            <div class="box">
                <h2>これまで献血に協力していただいた人数</h2>
                <div class="image-container">
                    <img src="../static/images/data-people.png" alt="Image description" />
                </div>
                <p><span class="count" data-count="{{total_blood_donors}}">0</span>人</p>
            </div>
            <div class="box">
                <h2>これまでに献血された血液の総量</h2>
                <div class="image-container">
                    <img src="../static/images/data-blood.png" alt="Image description" />
                </div>
                <p><span class="count" data-count="{{total_blood}}">0</span>kL</p>
            </div>
            <div class="box">
                <h2>献血ルームの総数</h2>
                <div class="image-container">
                    <img src="../static/images/data-room.png" alt="Image description" />
                </div>
                <p><span class="count" data-count="{{total_room}}">0</span>箇所</p>
            </div>
        </section>
    </div>
    <footer>
    <ul class="footer-items">
        <li><a class="footer-item" href="/about">このサイトについて</a></li>
        <li><a class="footer-item" href="/abbout#contact">お問い合わせ</a></li>
        <li><a class="footer-item" href="/about#used">使用しているデータについて</a></li>
    </ul>
        <p class="copyright">© 2024 献血ナビ</p>
    </footer>
</body>
</html>
